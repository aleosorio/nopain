---
title: "Zingtree Visualizations"
author: "MAO"
date: "27-06-2019"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Librerías:
```{r, message = FALSE}
library(tidyverse)
library(jsonlite)
```

## I. Obteniendo Datos de Zingtree

### I.a. Sesiones de Agentes

- **Nombre de consulta API**: agent_sessions
- **Estructura de consulta API**:
'https://zingtree.com/api/agent_sessions/{{apikey}}/{{agent}}/{{dateini}}/{{datefin}}'

Parámetros de consulta:
```{r}
apikey <- "4c92e2fd3f24f25d02308f6b8d7dd53c"
agent <- "*"
dateini <- "2019-06-23"
datefin <- "2019-06-27"
```

Importando desde URL Zingtree, las variables "session_id", "start_time" (renombrándola "session_date") y "agent" del dataframe "sessions", desde la lista fuente:
```{r, message = FALSE}
agent_sessions <- fromJSON(txt = str_c("https://zingtree.com/api/agent_sessions/", apikey, "/", agent, "/", dateini, "/", datefin)) %>%
  .$sessions %>%
  select(., session_id, session_date = start_time, agent)
```

Eliminando hora y dejando sólo la fecha de la variable "session_date".  Luego cambiando a formato 'date':
```{r message = FALSE}
agent_sessions$session_date <- str_sub(agent_sessions$session_date, 1, 10) %>%
  as.Date(.)
```

Dataframe obtenida:
```{r, echo = FALSE}
str(agent_sessions, 5)
```

### I.b. Detalle de Sesiones

- **Nombre de consulta API**: get_session_data
- **Estructura de consulta API**:
https://zingtree.com/api/session/{{session_id}}/get_session_data

#### I.b.i. Función de extracción para una sesión (get_session_data)

- **Parámetros**: session_id
- **Input**: JSON de Zingtree para session_ID
- **Output**: PENDIENTE

```{r}
get_session_data <- function(session_id) {
  fromJSON(txt = str_c("https://zingtree.com/api/session/", session_id, "/get_session_data")) %>%
  .$path
}
```



